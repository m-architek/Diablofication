<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Diablofication | Character Respawn</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div class="container-lg px-3 my-5 markdown-body">
        <h2 id="character-respawn">Character Respawn</h2>

        <p>This component prevents "Game Over" screen on protagonist character death (including petrification),
            situations when all alive party members are "unavailable" (e.g. charmed or in maze)
            and in some plot related situations (fail to cure Marek's poison on time, refusing arrest in Candlekeep).</p>

        <p>Regarding first point, protagonist is now never really dead. The minimum HP cap of 1 is introduced to prevent
            real death (maximum HP is also increased by 1 to "give back" occupied point). When protagonist HP reach
            value of 1, respawn process is triggered by game scripts.
            As side effect of this approach, effects that in unmodded game decrease target HP to 1 are now patched to leave 2 HP.
            In case of instant kill effects (like petrification or disintegration), protagonist is immune to effect itself,
            but instead respawn process is triggered.</p>

        <p>Infinity Engine provides many ways to kill character. To handle all of them, this component patches
            all items and spells in game (including those added by mods) to apply proper markers for respawn process triggering.
            In result, respawn process will be triggered in all and only those situations, 
            that would cause character death in unmodded game.
            The only exception to this rule is reducing character statistic below zero by equipping an item.
            Other sources of statistics drain, like spells or monsters special attacks, will still kill the character.</p>

        <p>"Game over" when entire party is "unavailable" seems to be performed by engine itself, however it can be
            configured per location. This component prevents "game over" in such situations for every location in the
            game (included those from mods). Situation when entire party is "unavailable" is detected by scripts and triggers
            respawn process.</p>

        <p>For plot related "game over" situations, component tries to recover game in arguably most sensible way. If
            you die from Marek's poison you will respawn normally and another ten days would be given for you to stop
            this poison. If you die in Candlekeep after you will be marked as "criminal", you will respawn in Candlekeep
            prison and game will continue from there as you would be normally arrested. Note, that since attacking Iron
            Throne leaders mark you as criminal, you have only one chance to deal with this encounter.</p>

        <p>There are situations in game that do not result in explicit "game over", but also it is not possible to recover
            from them to finish the game (e.g. attacking someone innocent during Candlekeep Prologue).
            This component do not handle such situations in any particular way.
            Notable exception is escort mission in Ducal Palace. This component makes Grand Dukes unkillable,
            what makes this escort mission immposible to fail. Enemies AI during this fight is slightly changed,
            to target protagonist and other party members instead of Grand Dukes.</p>

        <p>All possible respawn points are configured in <a href="../config/respawn_points.2da">respawn_points.2da</a>
            table.
            Configuration includes areas and players position after respawn. Plot related respawn points are hardcoded
            and always take precedence, however you can configure nearest respawn point for areas with <a
                href="../config/respawn_points_nearest.2da">respawn_points_nearest.2da</a> table. If newly visited
            area do not have respawn point configured here, the value of previously visited area would be used.
            Note that all changes to those 2da tables must be performed before component is installed.</p>

        <p>During respawn process all party members are resurrected and healed. Healing process include
            all effects of normal heal, neutralize poison, restoration, spiritual clarity and dispel magic. 
            It restores natural form if character was under polymorph effect. It also makes party fully rest.
            Some non magical effects that are not removed with spell mentioned above (like physical or psionic paralysis)
            can still persist after respawn, until their duration expires.</p>

        <p>After respawn, protagonist should have all equipment that was possessed in moment of "death", however
            equipment of dead companions is still on battlefield (unless it was picked up meanwhile by protagonist or
            other party member). Please note, that in case you cannot go back to place of party member death 
            (e.g. fight with Iron Throne leaders in Candlekeep), this can cause loss of this equipment.</p>

        <p>Each respawn has consequence in certain penalty of gold and XP. Amount of gold that is taken from the party
            depends on current party gold and it is configured in <a
                href="../config/respawn_penalty_gold.2da">respawn_penalty_gold.2da</a> table.
            XP penalty is applied on each party member separately and it depends on character current XP,
            it is configured in <a href="../config/respawn_penalty_xp.2da">respawn_penalty_xp.2da</a> table.
            Note that all changes to those 2da tables must be performed before component is installed. 
            In case you change configuration, you should also avoid reducing character's XP below 0, 
            which is not handled properly by the engine. XP penalty does not affect character level,
            it just delays getting next level.</p>

        <p>After respawn, protagonist receives innate ability that allows for teleport entire party back to the place of last "death".
            This is reusing <a href="town_portal.html">Town Portal</a> return mechanics, 
            so it overwrites eventual return ability that exists after casting Town Portal spell.</p>

        <hr />

        <p><a href="../index.html#character-respawn">&lt; Back to Readme</a></p>
    </div>
</body>

</html>